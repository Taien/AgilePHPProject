/*
Deployment script for WorkWithMe

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "WorkWithMe"
:setvar DefaultFilePrefix "WorkWithMe"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (OPERATION_MODE = READ_WRITE) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [dbo].[tblCity]...';


GO
CREATE TABLE [dbo].[tblCity] (
    [Id]       INT          NOT NULL,
    [CityName] VARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblGroup]...';


GO
CREATE TABLE [dbo].[tblGroup] (
    [Id]               INT          NOT NULL,
    [Name]             VARCHAR (50) NOT NULL,
    [Description]      VARCHAR (50) NOT NULL,
    [GroupType]        VARCHAR (50) NOT NULL,
    [OwnerUserId]      INT          NOT NULL,
    [OwnerGroupId]     INT          NULL,
    [GroupImg]         IMAGE        NULL,
    [CanPostDefault]   INT          NOT NULL,
    [CanInviteDefault] INT          NOT NULL,
    [CanDeleteDefault] INT          NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblGroupInvite]...';


GO
CREATE TABLE [dbo].[tblGroupInvite] (
    [Id]            INT NOT NULL,
    [OwnerUserId]   INT NOT NULL,
    [TargetUserId]  INT NOT NULL,
    [TargetGroupId] INT NOT NULL,
    [InviteStatus]  INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblGroupType]...';


GO
CREATE TABLE [dbo].[tblGroupType] (
    [Id]          INT          NOT NULL,
    [Description] VARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblGroupUser]...';


GO
CREATE TABLE [dbo].[tblGroupUser] (
    [Id]           INT NOT NULL,
    [UserId]       INT NOT NULL,
    [GroupId]      INT NOT NULL,
    [IsGroupAdmin] BIT NOT NULL,
    [CanPost]      BIT NOT NULL,
    [CanInvite]    BIT NOT NULL,
    [CanDelete]    BIT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblInviteStatus]...';


GO
CREATE TABLE [dbo].[tblInviteStatus] (
    [Id]          BIT          NOT NULL,
    [Description] VARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblPost]...';


GO
CREATE TABLE [dbo].[tblPost] (
    [Id]             INT          NOT NULL,
    [OwnerUserId]    INT          NOT NULL,
    [TargetGroupId]  INT          NOT NULL,
    [Title]          VARCHAR (50) NOT NULL,
    [Content]        VARCHAR (50) NOT NULL,
    [IsSticky]       BIT          NOT NULL,
    [IsDeleted]      BIT          NOT NULL,
    [TimeStamp]      DATETIME     NOT NULL,
    [EventTimeStamp] DATETIME     NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblState]...';


GO
CREATE TABLE [dbo].[tblState] (
    [Id]        INT          NOT NULL,
    [StateName] VARCHAR (50) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblUser]...';


GO
CREATE TABLE [dbo].[tblUser] (
    [Id]               UNIQUEIDENTIFIER NOT NULL,
    [Username]         VARCHAR (50)     NOT NULL,
    [PasswordHash]     BINARY (64)      NOT NULL,
    [PasswordSalt]     UNIQUEIDENTIFIER NOT NULL,
    [FirstName]        VARCHAR (50)     NOT NULL,
    [MiddleIntial]     VARCHAR (50)     NOT NULL,
    [LastName]         VARCHAR (50)     NOT NULL,
    [Zip]              VARCHAR (50)     NULL,
    [Address]          VARCHAR (50)     NULL,
    [IsAddressPrivate] BIT              NOT NULL,
    [UserImg]          IMAGE            NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[tblZip]...';


GO
CREATE TABLE [dbo].[tblZip] (
    [Id]      INT NOT NULL,
    [CityId]  INT NOT NULL,
    [StateId] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Update complete.';


GO
